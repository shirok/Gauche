#
# Scoop manifesto generator
#
# NB: See also Scoop (https://scoop.sh/)
#

top_builddir = @top_builddir@

VERSION = @PACKAGE_VERSION@
MSI64   = $(top_builddir)/../Gauche-mingw-$(VERSION)-64bit.msi
MSI32   = $(top_builddir)/../Gauche-mingw-$(VERSION)-32bit.msi

TARGET = gauche.json

GOSH = @BUILD_GOSH@

all: $(TARGET)

.PHONY: all clean distclean

$(TARGET): make-scoop-manifesto.scm
	$(GOSH) $< --version=$(VERSION) --msi64=$(MSI64) --msi32=$(MSI32) > $@
	emacs --batch --file=$@ --load=json \
		--eval='(setq json-encoding-default-indentation "    ")' \
		--funcall=json-pretty-print-buffer \
		--eval="(set-buffer-file-coding-system 'utf-8-dos)" \
		--funcall=save-buffer

clean:
	rm -f $(TARGET) $(TARGET:=~)

distclean: clean
	rm -f Makefile
