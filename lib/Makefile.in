#
# Makefile.in for Gauche/lib
#

.PHONY: all check install uninstall slibcat slibcat-in-place \
	clean distclean maintainer-clean

DESTDIR =

prefix      = @prefix@
exec_prefix = @exec_prefix@
bindir      = @bindir@
libdir      = @libdir@
srcdir      = @srcdir@
VPATH       = $(srcdir)
top_builddir = @top_builddir@
top_srcdir   = @top_srcdir@
datadir     = @datadir@
datarootdir = @datarootdir@
build       = @build@
host        = @host@

GAUCHE_DATA_DIR = $(datadir)/gauche-@GAUCHE_ABI_VERSION@
SCM_INSTALL_DIR = $(GAUCHE_DATA_DIR)/@GAUCHE_VERSION@/lib
INSTALL         = @INSTALL@
INSTALL_DATA    = @INSTALL_DATA@
MKINSTDIR       = $(top_srcdir)/mkinstalldirs
SLIB_DIR        = @SLIB_DIR@

PREGENERATED    = gauche/vm/insn.scm gauche/config.scm srfi-*
CONFIG_GENERATED = Makefile

SUBDIRS  = gauche gauche/vm gauche/configure gauche/serializer \
	   gauche/interactive gauche/mop \
	   gauche/package gauche/cgen gauche/experimental gauche/test \
	   gauche/regexp \
	   lang lang/asm lang/c \
	   srfi srfi/160 srfi-29 srfi/29 srfi/146 \
	   srfi-159 srfi-159/internal srfi/159 srfi/160 srfi/172 srfi/194 \
	   srfi/226 srfi/227 \
	   binary control data dbd dbm math util compat file \
	   parser parser/peg rfc rfc/http \
	   scheme scheme/mapping scheme/show scheme/stream scheme/vector \
	   text text/unicode text/console tools www www/cgi

# Note: srfi-*.scm is generated by src/srfis.scm

SCMFILES = \
       srfi-*.scm srfi/*.scm \
       srfi-29/*.scm srfi/29/*.scm \
       srfi/146/hash.scm \
       srfi-159/*.sld srfi-159/*.scm \
       srfi-159/internal/*.sld srfi-159/internal/*.scm srfi/159/*.scm \
       srfi/160/*.scm \
       srfi/172/*.scm \
       srfi/194/*.scm \
       srfi/226/*.scm \
       srfi/227/*.scm \
       slib.scm \
       check-script \
       gauche/test.scm gauche/test/script.scm \
       gauche/test/diff.scm gauche/test/include.scm \
       gauche/time.scm gauche/connection.scm \
       gauche/fmtutil.scm gauche/redefutil.scm \
       gauche/vecutil.scm gauche/portutil.scm \
       gauche/hashutil.scm gauche/treeutil.scm gauche/computil.scm \
       gauche/netutil.scm gauche/modutil.scm gauche/libutil.scm  \
       gauche/generic-sortutil.scm gauche/fileutil.scm gauche/sysutil.scm \
       gauche/regexp.scm gauche/regexp/sre.scm \
       gauche/sigutil.scm gauche/numutil.scm gauche/let-opt.scm \
       gauche/logutil.scm \
       gauche/vm/bbb.scm gauche/vm/debugger.scm gauche/vm/debug-info.scm \
       gauche/vm/insn-core.scm gauche/vm/insn.scm \
       gauche/vm/profiler.scm gauche/vm/register-machine.scm \
       gauche/pputil.scm gauche/procutil.scm \
       gauche/serializer.scm gauche/serializer/aserializer.scm \
       gauche/parseopt.scm gauche/interactive.scm gauche/interactive/info.scm \
       gauche/interactive/init.scm \
       gauche/interactive/toplevel.scm \
       gauche/interactive/editable-reader.scm \
       gauche/interactive/completion.scm \
       gauche/selector.scm gauche/logger.scm \
       gauche/common-macros.scm gauche/singleton.scm gauche/validator.scm \
       gauche/version.scm gauche/version-alist.scm \
       gauche/partcont.scm gauche/partcont-meta.scm \
       gauche/lazy.scm gauche/base.scm \
       gauche/interpolate.scm gauche/listener.scm \
       gauche/config.scm gauche/reload.scm \
       gauche/configure.scm gauche/configure/base.scm \
       gauche/configure/lang.scm gauche/configure/prog.scm \
       gauche/configure/init.scm gauche/configure/compile.scm \
       gauche/configure/output.scm \
       gauche/mop/bound-slot.scm \
       gauche/mop/instance-pool.scm gauche/mop/validator.scm \
       gauche/mop/propagate.scm gauche/mop/singleton.scm \
       gauche/mop/typed-slot.scm \
       gauche/cgen.scm gauche/cgen/unit.scm gauche/cgen/literal.scm \
       gauche/cgen/cise.scm gauche/cgen/type.scm gauche/cgen/stub.scm \
       gauche/cgen/precomp.scm gauche/cgen/optimizer.scm \
       gauche/cgen/standalone.scm gauche/cgen/tmodule.scm \
       gauche/cgen/cbe.scm \
       gauche/package.scm gauche/package/build.scm gauche/package/fetch.scm \
       gauche/package/util.scm gauche/package/compile.scm \
       gauche/package/commands.scm \
       gauche/experimental/ref.scm gauche/experimental/lamb.scm \
       gauche/experimental/app.scm gauche/experimental/shared-struct.scm \
       r7rs-setup.scm \
       binary/ftype.scm binary/pack.scm \
       control/cseq.scm control/future.scm control/job.scm control/plumbing.scm \
       control/pmap.scm control/scheduler.scm control/thread-pool.scm \
       dbi.scm dbd/null.scm dbm.scm dbm/fsdbm.scm dbm/dump dbm/restore \
       data/cache.scm data/heap.scm \
       data/ideque.scm data/imap.scm data/priority-map.scm data/random.scm \
       data/range.scm data/skew-list.scm data/ulid.scm \
       lang/asm/regset.scm lang/asm/x86_64.scm \
       lang/c/parameter.scm lang/c/lexer.scm lang/c/parser.scm \
       lang/c/type.scm \
       math/const.scm math/prime.scm math/simplex.scm \
       util/isomorph.scm util/toposort.scm util/tree.scm util/queue.scm \
       util/digest.scm util/combinations.scm util/lcs.scm util/list.scm \
       util/record.scm util/relation.scm util/stream.scm util/trie.scm \
       util/rbtree.scm util/sparse.scm util/dominator.scm \
       util/levenshtein.scm util/unification.scm util/temporal-relation.scm \
       compat/chibi-test.scm compat/jfilter.scm compat/stk.scm \
       compat/norational.scm compat/real-elementary-functions.scm \
       compat/r7rs-srfi-tests.scm \
       file/filter.scm \
       rfc/mime-port.scm rfc/base64.scm rfc/uri.scm \
       rfc/cookie.scm rfc/quoted-printable.scm rfc/http.scm rfc/http/tunnel.scm \
       rfc/hmac.scm rfc/ftp.scm rfc/icmp.scm rfc/ip.scm rfc/json.scm \
       rfc/uuid.scm \
       scheme/base.scm scheme/box.scm scheme/bitwise.scm \
       scheme/bytevector.scm \
       scheme/case-lambda.scm scheme/char.scm \
       scheme/comparator.scm scheme/complex.scm scheme/cxr.scm \
       scheme/division.scm scheme/ephemeron.scm scheme/eval.scm \
       scheme/file.scm scheme/fixnum.scm \
       scheme/generator.scm scheme/hash-table.scm scheme/ideque.scm \
       scheme/inexact.scm scheme/ilist.scm scheme/lazy.scm \
       scheme/list-queue.scm scheme/load.scm \
       scheme/lseq.scm scheme/mapping.scm scheme/mapping/hash.scm \
       scheme/process-context.scm scheme/r5rs.scm scheme/read.scm \
       scheme/regex.scm scheme/repl.scm scheme/rlist.scm \
       scheme/set.scm scheme/sort.scm scheme/show.scm \
       scheme/show/base.scm scheme/show/color.scm scheme/show/columnar.scm \
       scheme/show/unicode.scm \
       scheme/stream.scm scheme/stream/primitive.scm scheme/stream/derived.scm \
       scheme/time.scm scheme/text.scm \
       scheme/write.scm \
       scheme/vector/base.scm scheme/vector/u8.scm scheme/vector/s8.scm \
       scheme/vector/u16.scm scheme/vector/s16.scm \
       scheme/vector/u32.scm scheme/vector/s32.scm \
       scheme/vector/u64.scm scheme/vector/s64.scm \
       scheme/vector/f32.scm scheme/vector/f64.scm \
       scheme/vector/c64.scm scheme/vector/c128.scm \
       text/csv.scm text/edn.scm text/external-editor.scm \
       text/multicolumn.scm text/parse.scm text/tree.scm text/sql.scm \
       text/html-lite.scm text/info.scm text/diff.scm \
       text/pager.scm text/progress.scm \
       text/console/framebuffer.scm text/console/wide-char-setting.scm \
       text/console/windows.scm \
       text/segmented-match.scm text/sh.scm text/template.scm \
       text/unicode.scm text/unicode/ucd.scm text/unicode/codeset.scm \
       tools/build-standalone tools/check-script \
       tools/genstub tools/get-cacert \
       tools/make-export-list tools/precomp tools/docprep \
       tools/compile-r7rs \
       www/cgi.scm www/cgi-test.scm www/cgi/test.scm www/css.scm

all:

check:

install:
	for d in $(SUBDIRS); do \
	  "$(MKINSTDIR)" "$(DESTDIR)$(SCM_INSTALL_DIR)/$$d"; \
	done
	for p in $(SCMFILES); do \
	  $(INSTALL_DATA) "$$p" "$(DESTDIR)$(SCM_INSTALL_DIR)/$$p"; \
	done
	if test -f slibcat; then \
	  $(INSTALL_DATA) slibcat "$(DESTDIR)$(SCM_INSTALL_DIR)/slibcat"; \
	fi
	$(INSTALL) -m 555 tools/compile-r7rs "$(bindir)"

uninstall:

# If we have slib, creates catalog file for Gauche.   This should be called
# after everything is installed.
# For RPM, this has to be called in the postinstall script instead of
# installation script.
slibcat :
	if test -f "$(SLIB_DIR)/require.scm" && test $(build) = $(host) ; then \
	  "$(exec_prefix)/bin/gosh" -ftest -fno-warn-srfi-feature-id -uslib -E"require 'new-catalog" -Eexit;\
	fi

# Some package systems don't allow to run postinstall commands.  For such
# systems, this target tries to create "slibcat" within this directory
# before installing gosh.
slibcat-in-place :
	if test -f "$(SLIB_DIR)/require.scm"; then \
	  $(SHELL) ./mklibcat $(top_builddir)/src/gosh ; \
	fi

clean:
	rm -rf core slibcat *.sci *~
	for d in $(SUBDIRS); do if test -d $$d; then (cd $$d; rm -f core *.sci *~); fi; done

distclean: clean
	rm -f $(CONFIG_GENERATED)

maintainer-clean: clean
	rm -f $(CONFIG_GENERATED) $(PREGENERATED)
